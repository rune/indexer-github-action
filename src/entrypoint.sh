#!/bin/sh -l

# Ensure the process fails if any subcommand fails
set -e

# Generate indices
cd /src
node index.js $GITHUB_WORKSPACE

# Commit and push generated indices
cd $GITHUB_WORKSPACE
git config --global --add safe.directory $GITHUB_WORKSPACE
git config --global user.name "${INPUT_CI_USERNAME}"
git config --global user.email "${INPUT_CI_EMAIL}"
git add .
git commit -m "Autogenerated indices" || true
remote_repo="https://${INPUT_CI_AUTH_TOKEN}@github.com/${GITHUB_REPOSITORY}.git"
echo "${remote_repo}"
git push "${remote_repo}" HEAD:$GITHUB_REF
